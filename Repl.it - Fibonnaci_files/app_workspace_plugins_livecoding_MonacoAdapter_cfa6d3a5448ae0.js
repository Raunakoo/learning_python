__NEXT_REGISTER_CHUNK("app_workspace_plugins_livecoding_MonacoAdapter_cfa6d3a5448ae027e371553a451789d7",function(){webpackJsonp([8],{2152:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2187);r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,function(){return n[e]})}(o)},2187:function(e,t,r){e.exports=r(2126)(207)},900:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1287),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function i(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}var c=function(){return function(e,t){this.target=t,this.type=e}}(),u=function(e){function t(t,r){var n=e.call(this,"error",r)||this;return n.message=t.message,n.error=t,n}return i(t,e),t}(c),l=function(e){function t(t,r,n){void 0===t&&(t=1e3),void 0===r&&(r="");var o=e.call(this,"close",n)||this;return o.wasClean=!0,o.code=t,o.reason=r,o}return i(t,e),t}(c),d=function(){if("undefined"!=typeof WebSocket)return WebSocket},f={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1},b=function(){function e(e,t,r){void 0===r&&(r={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.eventToHandler=new Map([["open",this._handleOpen.bind(this)],["close",this._handleClose.bind(this)],["error",this._handleError.bind(this)],["message",this._handleMessage.bind(this)]]),this.onclose=void 0,this.onerror=void 0,this.onmessage=void 0,this.onopen=void 0,this._url=e,this._protocols=t,this._options=r,this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce(function(e,t){return"string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e},0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED||this._connect(),this._disconnect(e,t),this._connect()},e.prototype.send=function(e){this._ws&&this._ws.readyState===this.OPEN?(this._debug("send",e),this._ws.send(e)):(this._debug("enqueue",e),this._messageQueue.push(e))},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(e){return e!==t}))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}(["RWS>"],e))},e.prototype._getNextDelay=function(){var e=0;if(this._retryCount>0){var t=this._options,r=t.reconnectionDelayGrowFactor,n=void 0===r?f.reconnectionDelayGrowFactor:r,o=t.minReconnectionDelay,i=void 0===o?f.minReconnectionDelay:o,s=t.maxReconnectionDelay,a=void 0===s?f.maxReconnectionDelay:s;(e=i*Math.pow(n,this._retryCount-1))>a&&(e=a)}return this._debug("next delay",e),e},e.prototype._wait=function(){var e=this;return new Promise(function(t){setTimeout(t,e._getNextDelay())})},e.prototype._getNextUrl=function(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){var t=e();if("string"==typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,r=t.maxRetries,n=void 0===r?f.maxRetries:r,o=t.connectionTimeout,i=void 0===o?f.connectionTimeout:o,s=t.WebSocket,a=void 0===s?d():s;if(this._retryCount>=n)this._debug("max retries reached",this._retryCount,">=",n);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),"function"!=typeof(c=a)||2!==c.CLOSING)throw Error("No valid WebSocket class provided");var c;this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(t){e._closeCalled||(e._debug("connect",{url:t,protocols:e._protocols}),e._ws=e._protocols?new a(t,e._protocols):new a(t),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},i))})}}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new u(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),clearTimeout(this._connectTimeout),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new l(e,t,this))}catch(e){}}},e.prototype._acceptOpen=function(){this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._handleOpen=function(e){var t=this;this._debug("open event");var r=this._options.minUptime,n=void 0===r?f.minUptime:r;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(function(){return t._acceptOpen()},n),this._debug("assign binary type"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(function(e){return t._ws.send(e)}),this._messageQueue=[],this.onopen&&this.onopen(e),this._listeners.open.forEach(function(r){return t._callEventListener(e,r)})},e.prototype._handleMessage=function(e){var t=this;this._debug("message event"),this.onmessage&&this.onmessage(e),this._listeners.message.forEach(function(r){return t._callEventListener(e,r)})},e.prototype._handleError=function(e){var t=this;this._debug("error event",e.message),this._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),this.onerror&&this.onerror(e),this._debug("exec error listeners"),this._listeners.error.forEach(function(r){return t._callEventListener(e,r)}),this._connect()},e.prototype._handleClose=function(e){var t=this;this._debug("close event"),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(e),this._listeners.close.forEach(function(r){return t._callEventListener(e,r)})},e.prototype._removeListeners=function(){var e,t;if(this._ws){this._debug("removeListeners");try{for(var r=s(this.eventToHandler),n=r.next();!n.done;n=r.next()){var o=a(n.value,2),i=o[0],c=o[1];this._ws.removeEventListener(i,c)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}},e.prototype._addListeners=function(){var e,t;this._debug("addListeners");try{for(var r=s(this.eventToHandler),n=r.next();!n.done;n=r.next()){var o=a(n.value,2),i=o[0],c=o[1];this._ws.addEventListener(i,c)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e}(),h=r(1288),p=r.n(h),v=r(2152),y=r(1289),g=r(1088),m=r.n(g);function w(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){P(e,t,r[t])})}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.d(t,"MonacoAdapter",function(){return T});function j(e,t){var r=e.getLinesContent(),n=e.getEOL(),o=0,i=t;for(o=0;o<r.length;++o){var s=r[o];if(i<=s.length)break;i-=s.length+n.length}return{row:o+1,column:i+1}}var T=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),E.call(this),window.adapter=this,this.ignore=!1,this.editorInstance=t,this.cursorDecoration={},this.monacoListeners=[],this.token=r,this.username=p()(r).username}var t,r,n;return t=e,(r=[{key:"gotoUserCursor",value:function(e){var t=this.cursorDecoration[e];if(t){var r=Object.keys(t)[0];this.switchFile(r);var n=t[r].cursor[0],o=v.Uri.from({scheme:"file",path:r}),i=v.editor.getModel(o).getDecorationRange(n),s=i.startLineNumber,a=i.endLineNumber;this.editorInstance.revealLinesInCenter(s,a)}}},{key:"promoteUser",value:function(e){if(this.isAdmin()&&this.doc){var t=this.doc.data.users[e];t.canEdit?t.isAdmin||(this.doc.submitOp({p:["users",e,"isAdmin"],od:!1,oi:!0}),this.updateUser(e,{isAdmin:!0})):(this.doc.submitOp({p:["users",e,"canEdit"],od:!1,oi:!0}),this.updateUser(e,{canEdit:!0}))}}},{key:"demoteUser",value:function(e){if(this.isAdmin()&&this.doc){var t=this.doc.data.users[e];t.isAdmin?(this.doc.submitOp({p:["users",e,"isAdmin"],od:!0,oi:!1}),this.updateUser(e,{isAdmin:!1})):t.canEdit&&(this.doc.submitOp({p:["users",e,"canEdit"],od:!0,oi:!1}),this.updateUser(e,{canEdit:!1}))}}},{key:"banUser",value:function(e){this.isAdmin()&&this.doc&&(this.doc.submitOp({p:["bannedUsers",this.doc.data.bannedUsers.length-1],li:e}),this.dropUser(e))}},{key:"isAdmin",value:function(){if(this.doc){var e=this.doc.data;if(this.username)return e.users[this.username].isAdmin}}},{key:"isOwner",value:function(){if(this.doc){var e=this.doc.data;if(this.username)return e.users[this.username].isOwner}}}])&&C(t.prototype,r),n&&C(t,n),e}(),E=function(){var e=this;Object.defineProperty(this,"ignore",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editorInstance",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"token",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cursorDecoration",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monacoListeners",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"username",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"doc",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userToFollow",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settingOwnPosition",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onDisconnect",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onSessionTerminated",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dispatchFileChange",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"addUser",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateUser",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dropUser",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dispatchNewFile",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dispatchDeleteFile",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"switchFile",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getFiles",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onDocLoaded",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setConnectionError",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"unfollowUserCursor",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatePreferences",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getPreferences",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"connect",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r="token=".concat(encodeURIComponent(e.token),"&docId=").concat(encodeURIComponent(t)),o="wss://live.repl.it/?".concat(r);e.socket=new b(o,[],{maxRetries:5});var i=new n.Connection(e.socket);e.socket.addEventListener("close",e.onSocketClose),e.doc=i.get("workspace",t),e.doc.subscribe(),e.doc.on("op",function(t,r){r||(e.ignore=!0,e.applyOperations(t),e.ignore=!1)}),e.doc.on("load",function(){if(e.ignore=!0,!(e.doc.data&&e.doc.data.files&&e.doc.data.cursors&&e.doc.data.users&&e.doc.data.editorPreferences))throw new Error("Expected doc to load with data from server got "+JSON.stringify(e.doc.data));e.initMonacoListeners(),e.initFiles(),e.initCursors(),e.initUsers(),e.initPreferences(),e.ignore=!1,e.onDocLoaded()}),e.doc.on("del",function(){e.onSessionTerminated(),e.disconnect()})}}),Object.defineProperty(this,"disconnect",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.doc=void 0,e.closeSocket(),e.cleanupMonacoListeners(),e.clearUsersAndCursors(),e.onDisconnect()}}),Object.defineProperty(this,"onSocketClose",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=t.reason;Object.values(m.a).includes(r)?(e.disconnect(),e.setConnectionError(r)):e.socket.retryCount>=5&&e.disconnect()}}),Object.defineProperty(this,"closeSocket",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.socket&&(e.socket.removeEventListener("close",e.onSocketClose),e.socket.close(),e.socket=void 0)}}),Object.defineProperty(this,"clearUsersAndCursors",{configurable:!0,enumerable:!0,writable:!0,value:function(){for(var t=Object.keys(e.cursorDecoration),r=0;r<t.length;r++){for(var n=t[r],o=Object.keys(e.cursorDecoration[n]),i=0;i<o.length;i++){var s=o[i];if(e.cursorDecoration[n][s]){var a=v.Uri.from({scheme:"file",path:s}),c=v.editor.getModel(a);c.deltaDecorations(e.cursorDecoration[n][s].fadingNameTag,[]),c.deltaDecorations(e.cursorDecoration[n][s].cursor,[])}}e.dropUser(n)}e.cursorDecoration={}}}),Object.defineProperty(this,"setEditor",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.editorInstance=t,e.cleanupMonacoListeners(),e.initMonacoListeners()}}),Object.defineProperty(this,"cleanupMonacoListeners",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.monacoListeners.forEach(function(e){e&&e.dispose()}),e.monacoListeners=[]}}),Object.defineProperty(this,"initMonacoListeners",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.monacoListeners.push(e.editorInstance.onDidChangeModelContent(e.onChange.bind(e)),e.editorInstance.onDidChangeCursorPosition(e.onCursorActivity.bind(e)))}}),Object.defineProperty(this,"initFiles",{configurable:!0,enumerable:!0,writable:!0,value:function(){if(e.doc){var t=e.doc.data,r=Object.keys(t.files);if(r.length)for(var n=0;n<r.length;n++){var o=r[n],i=L(o),s=v.editor.getModel("file://".concat(i)),a=t.files[o];s?s.getValue()!==a&&e.dispatchFileChange(i,a):e.dispatchNewFile(i,a)}else{var c=e.getFiles(),u=!0,l=!1,d=void 0;try{for(var f,b=c[Symbol.iterator]();!(u=(f=b.next()).done);u=!0){var h=f.value;e.onNewFile(O({},h,{noIgnore:!0}))}}catch(e){l=!0,d=e}finally{try{u||null==b.return||b.return()}finally{if(l)throw d}}}}}}),Object.defineProperty(this,"initCursors",{configurable:!0,enumerable:!0,writable:!0,value:function(){if(e.doc)for(var t=e.doc.data,r=Object.keys(t.cursors),n=0;n<r.length;n++){var o=r[n];if(o!==e.username){var i={p:["cursors",o],oi:t.cursors[o]};e.newCursor(i),e.drawCursor(i)}}}}),Object.defineProperty(this,"initUsers",{configurable:!0,enumerable:!0,writable:!0,value:function(){if(e.doc)for(var t=e.doc.data,r=Object.keys(t.users),n=0;n<r.length;n++){var o=r[n];e.addUser(o,t.users[o])}}}),Object.defineProperty(this,"initPreferences",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.doc;if(t){var r=t.data;if(Object.keys(r.editorPreferences).length){var n=r.editorPreferences,o=n.tabSize,i=n.insertSpaces;e.updatePreferences({tabSize:o,insertSpaces:i})}else{if(!e.isOwner())throw new Error("Preferences should've been set by owner");var s=e.getPreferences();t.submitOp({p:["editorPreferences"],oi:s})}}}}),Object.defineProperty(this,"onChange",{configurable:!0,enumerable:!0,writable:!0,value:function(t){if(e.doc&&!e.ignore){e.ignore=!0;var r=!0,n=!1,o=void 0;try{for(var i,s=t.changes[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var a=i.value;e.submitChange(e.editorInstance.getModel(),a)}}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}e.ignore=!1}}}),Object.defineProperty(this,"onCursorActivity",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.userToFollow&&!e.settingOwnPosition&&(e.userToFollow=null,e.unfollowUserCursor()),e.settingOwnPosition=!1;var t=e.editorInstance.getSelections().map(function(t){return{filePath:e.editorInstance.getModel().uri.path,cursorLine:t.positionLineNumber,cursorColumn:t.positionColumn,selectionStartLine:t.startLineNumber,selectionStartColumn:t.startColumn,selectionEndLine:t.endLineNumber,selectionEndColumn:t.endColumn}});if(e.doc&&e.username&&!e.ignore){var r={p:["cursors",e.username],oi:t};e.doc.data.cursors[e.username]&&(r.od=e.doc.data.cursors[e.username]),e.doc.submitOp(r)}}}),Object.defineProperty(this,"onOptionsChange",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=t.tabSize,n=t.insertSpaces,o=e.doc;o&&e.isOwner()&&o.submitOp({p:["editorPreferences"],oi:{tabSize:r,insertSpaces:n},od:o.data.editorPreferences})}}),Object.defineProperty(this,"onNewFile",{configurable:!0,enumerable:!0,writable:!0,value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){var r=t.path,n=t.value,o=t.noIgnore,i=k(r);!e.doc||e.ignore&&!o||e.doc.submitOp({p:["files",i],oi:n})})}),Object.defineProperty(this,"onDeleteFile",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=k(t.path);e.doc&&!e.ignore&&e.doc.submitOp({p:["files",r],od:e.doc.data.files[r]})}}),Object.defineProperty(this,"submitChange",{configurable:!0,enumerable:!0,writable:!0,value:function(t,r){var n=k(t.uri.path);if(e.doc&&e.doc.data){var o=e.doc.data.files[n];if("string"!=typeof o)e.doc.submitOp({p:["files",n],oi:t.getValue()});else{var i=r.rangeOffset;r.rangeLength>0&&e.doc.submitOp({p:["files",n,i],sd:o.substr(i,r.rangeLength)}),r.text&&e.doc.submitOp({p:["files",n,i],si:r.text})}}}}),Object.defineProperty(this,"applyOperations",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=new Set,n=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value,u=c.p[0];switch(u){case"files":var l=e.applyFileChanges(c);l&&r.add(l);break;case"cursors":e.applyCursorChanges(c);break;case"users":e.applyUserChanges(c);break;case"editorPreferences":e.applyPreferencesChanges(c);break;case"bannedUsers":break;default:throw new Error("Unknown operation type "+u)}}}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}if(e.doc){var d=e.doc.data,f=!0,b=!1,h=void 0;try{for(var p,y=r[Symbol.iterator]();!(f=(p=y.next()).done);f=!0){var g=p.value,m=v.Uri.parse("file://".concat(g)),w=v.editor.getModel(m),_=d.files[k(g)];w.getValue()!==_&&w.setValue(_)}}catch(e){b=!0,h=e}finally{try{f||null==y.return||y.return()}finally{if(b)throw h}}}}}),Object.defineProperty(this,"applyFileChanges",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=_(t.p,3),n=r[1],o=r[2],i=L(n);if(void 0===t.od)if(void 0===t.oi){if(void 0!==o){var s=v.Uri.parse("file://".concat(i)),a=v.editor.getModel(s),c=[],u=j(a,o),l=!1;if(void 0!==t.si){var d=u,f=new v.Range(u.row,u.column,d.row,d.column);c.push({range:f,text:t.si,forceMoveMarkers:!0}),a===e.editorInstance.getModel()&&e.editorInstance.getPosition().equals({column:u.column,lineNumber:u.row})&&(l=!0)}if(void 0!==t.sd){var b=j(a,o+t.sd.length),h=new v.Range(u.row,u.column,b.row,b.column);c.push({range:h,text:"",forceMoveMarkers:!0})}return a.applyEdits(c),l&&e.setCursorPosition({column:u.column,lineNumber:u.row}),i}}else e.dispatchNewFile(i,t.oi);else e.dispatchDeleteFile(i)}}),Object.defineProperty(this,"applyCursorChanges",{configurable:!0,enumerable:!0,writable:!0,value:function(t){t.oi&&!t.od?(e.newCursor(t),e.drawCursor(t)):t.oi?(e.deleteCursor(t),e.drawCursor(t)):t.od&&e.deleteCursor(t)}}),Object.defineProperty(this,"newCursor",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=_(t.p,2)[1];e.username!==r&&(e.cursorDecoration[r]={})}}),Object.defineProperty(this,"drawCursor",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=_(t.p,2)[1];if(e.username!==r&&t.oi){var n={},o=!0,i=!1,s=void 0;try{for(var a,c=t.oi[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=a.value,l=u.filePath,d=u.cursorLine,f=u.cursorColumn,b=u.selectionStartLine,h=u.selectionStartColumn,p=u.selectionEndLine,g=u.selectionEndColumn;n[l]||(n[l]={fadingNameTag:[],cursor:[]}),n[l].fadingNameTag=n[l].fadingNameTag.concat({range:new v.Range(d,f,d,f),options:{className:"cursor-tag-"+Object(y.a)(r),stickiness:v.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore,hoverMessage:{value:r,isTrusted:!1}}}),n[l].cursor=n[l].cursor.concat([{range:new v.Range(d,f,d,f),options:{className:"cursor-"+Object(y.a)(r),stickiness:v.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore,hoverMessage:{value:r,isTrusted:!1}}},{range:new v.Range(b,h,p,g),options:{className:"selection-"+Object(y.a)(r),stickiness:v.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore}}])}}catch(e){i=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw s}}for(var m=function(t){var o=v.Uri.from({scheme:"file",path:t}),i=v.editor.getModel(o);e.cursorDecoration[r][t]||(e.cursorDecoration[r][t]={fadingNameTag:[],cursor:[]}),e.cursorDecoration[r][t].cursor=i.deltaDecorations([],n[t].cursor),e.cursorDecoration[r][t].fadingNameTag=i.deltaDecorations([],n[t].fadingNameTag);var s=w(e.cursorDecoration[r][t].fadingNameTag);setTimeout(function(){i.isDisposed()||i.deltaDecorations(s,[])},2e3)},O=Object.keys(n),P=0;P<O.length;P++){m(O[P])}e.userToFollow===r&&e.gotoUserCursor(r)}}}),Object.defineProperty(this,"deleteCursor",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=_(t.p,2)[1],n=e.cursorDecoration[r];if(t.od&&n&&Object.keys(n).length){var o=!0,i=!1,s=void 0;try{for(var a,c=t.od[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=a.value.filePath,l=v.Uri.from({scheme:"file",path:u}),d=v.editor.getModel(l);if(!d)return;n[u]&&(d.deltaDecorations(n[u].cursor,[]),d.deltaDecorations(n[u].fadingNameTag,[]),delete e.cursorDecoration[r][u])}}catch(e){i=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw s}}}}}),Object.defineProperty(this,"applyUserChanges",{configurable:!0,enumerable:!0,writable:!0,value:function(t){if(e.doc){var r=_(t.p,2)[1],n=e.doc.data.users[r];3===t.p.length?e.updateUser(r,P({},t.p[2],t.oi)):t.od?(e.dropUser(r),r===e.userToFollow&&(e.userToFollow=null,e.unfollowUserCursor())):e.addUser(r,n)}}}),Object.defineProperty(this,"applyPreferencesChanges",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.doc&&e.updatePreferences(t.oi)}}),Object.defineProperty(this,"followUserCursor",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.setCursorPosition({column:1,lineNumber:1}),e.userToFollow=t,e.gotoUserCursor(t)}}),Object.defineProperty(this,"setCursorPosition",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var r=t.column,n=t.lineNumber;e.settingOwnPosition=!0,e.editorInstance.setPosition({column:r,lineNumber:n})}})};function k(e){return window.btoa(e)}function L(e){return window.atob(e)}}})});
//# sourceMappingURL=app_workspace_plugins_livecoding_MonacoAdapter_cfa6d3a5448ae027e371553a451789d7-617b092b96dd8f2f1edc.js.map